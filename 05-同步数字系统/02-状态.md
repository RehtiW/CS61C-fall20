## 例子:累加器
![[Pasted image 20241203093343.png]]
如果没有寄存器,将无法控制信息流

## 寄存器细节
![[Pasted image 20241203093907.png]]
寄存器是由n个并行的D型触发器(D-type Flip-Flop)构成,由同一时钟信号控制

## 触发器的时序变化(以D触发器为例)
在时钟信号的上升沿,输入d被采样，并传输到输出，在其他时间，d都被忽略
![[Pasted image 20241203094114.png]]
如上图所示
q开头的阴影部分为未定义状态，因为先前没有任何输入信号，视为垃圾状态
在时钟的上升沿，d为0且被采样，在经过延迟之后传输到输出q
![[Pasted image 20241203094325.png]]
因为有着延迟的存在
输入数据必须在"Setup"time+"hold"time时间内保持恒定，这样才能被正确采样并传输到输出端

## 回顾加法器及其波形图细节  
![[Pasted image 20241203094654.png]]

## 最大延迟:Tclk​≥Tmax​
![[Pasted image 20241203095025.png]]
## 插入寄存器以提高时钟频率

流水线通过**插入更多寄存器**来分隔计算任务的阶段，是为了提高处理器的时钟频率和整体性能。寄存器的引入在流水线中有以下几个关键作用：
### **1. 寄存器减少信号传播延迟**

- 在复杂电路中，信号从输入传播到输出需要经过多个逻辑门（例如加法器、乘法器等）。如果不使用寄存器，信号必须在一个时钟周期内完成整个路径。
- 插入寄存器将电路分为多个较小的逻辑段，每段只需处理一部分逻辑操作，减少了**信号传播的总路径长度（critical path）**。
- **关键点**：时钟周期受限于最长的信号路径。通过寄存器分隔，可以缩短最长路径，从而提升时钟频率。
### **2. 寄存器存储中间结果，便于阶段划分**

- 寄存器用于存储流水线各阶段的中间结果。
- 每个阶段（如取指、译码、执行、访存、回写）只负责完成其指定的任务，其结果被存储在寄存器中，传递给下一个阶段。
- 这种分阶段执行避免了任务间的相互干扰，提高了流水线的效率。



### 1. **clk-to-q 延迟**：

**clk-to-q 延迟**是指时钟信号的上升沿或下降沿触发之后，寄存器的输出（q）更新所需要的时间。换句话说，当时钟信号发生变化时，寄存器的输出不会立即改变，而是有一个固定的延迟时间。这个延迟是由寄存器本身的电气特性、工作原理以及内部逻辑处理决定的。

- **作用**：clk-to-q 延迟表示了**寄存器从时钟信号边沿到输出稳定所需的时间**，它是寄存器的一个内在延迟。

### 2. **组合逻辑延迟（Combination Logic Time）**：

在 **clk-to-q** 延迟之后，信号会进入组合逻辑电路进行处理。组合逻辑电路是由逻辑门（如与门、或门等）组成的，它根据输入信号进行运算并生成输出。每个逻辑门的运算有一定的时间延迟，这就是 **组合逻辑延迟**，通常称为 **logic delay** 或 **combinational delay**。

- **作用**：组合逻辑延迟表示信号在通过组合逻辑电路时，执行逻辑操作所需的时间。

### 3. **Setup Time**：

**Setup time** 是指数据输入必须在时钟信号的上升沿（或下降沿）之前，保持稳定的最小时间。换句话说，在时钟信号到达时，数据必须至少在 setup time 内保持不变，才能保证数据被寄存器正确采样和锁存。如果数据在 setup time 内发生变化，寄存器可能不会正确地捕获数据，从而导致错误。

- **作用**：Setup time 确保数据在时钟到来之前已经稳定，**为寄存器提供足够的时间来正确地锁存数据。**

### 为什么加在一起？

带寄存器的组合线路延迟的总时间是 **clk-to-q** + **combination logic time** + **setup time**，因为：

1. **clk-to-q 延迟**表示数据从寄存器输出到进入组合逻辑的时间。
2. **组合逻辑延迟**表示数据在组合逻辑电路中处理的时间。
3. **setup time**确保寄存器能正确捕捉经过组合逻辑处理后的数据。

因此，信号通过整个路径的总延迟是所有这些单独延迟的总和，确保在时钟周期内，数据能在适当的时间内从输入到达输出并被正确处理。