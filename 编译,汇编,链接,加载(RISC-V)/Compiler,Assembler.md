## Compiler
将高级语言编译为汇编语言生成 **.s** 文件
## Assembler
输入: .s文件
输出: .o文件
 **1.Reads and Uses Directives（读取和使用指令）**
 转换成相应的机器代码
 **2.Replace Pseudo-instructions（替换伪指令）**
 例如，像 `mv` 这样的伪指令并没有直接对应的机器指令，而是由汇编器转换为实际的机器指令
 **3.Produce Machine Language（生成机器语言）**
 **4.Creates Object File（生成目标文件）**
 目标文件通常包含机器代码，但它是一个**中间文件，不能直接执行**。目标文件包含了程序的**代码段、数据段、符号表、调试信息**等。它通常有 `.o` 或 `.obj` 后缀，且未完全链接成可执行文件。目标文件将在**链接阶段与其他目标文件和库文件一起合并**，生成最终的可执行文件。
 
 ### 1. **Object File Header（对象文件头）**

对象文件头是文件的起始部分，描述了文件的结构。它包含了有关该对象文件的元数据，如：

- **文件大小**：对象文件的总大小。
- **各个段的位置和大小**：标识文本段（.text）、数据段（.data）、重定位信息、符号表和调试信息等内容的大小和位置。
- **格式标识**：确定文件格式（如 ELF 格式）。

对象文件头帮助链接器和加载器了解如何解析和加载该对象文件。

### 2. **Text Segment（代码段）**

代码段（或称文本段，**`.text` 段**）存储程序的机器代码，通常由编译器将源代码转换为机器指令时生成。

- **内容**：该段包含程序的可执行指令，如 RISC-V 指令集中的加法指令、跳转指令等。
- **特性**：代码段通常是只读的，程序运行时不能修改其内容。
- **RISC-V**：在 RISC-V 程序中，代码段存储所有的汇编指令转换后的机器码。

### 3. **Data Segment（数据段）**

数据段（**`.data` 段**）存储程序中所有已初始化的全局变量、静态变量和常量的二进制表示。

- **内容**：已初始化的数据，例如 `int global_var = 5;` 这类静态或全局变量。
- **未初始化数据（BSS）**：未初始化的静态变量和全局变量通常存储在 `.bss` 段（Block Started by Symbol），程序启动时会被填充为零。

在 RISC-V 程序中，数据段不仅存储已初始化的数据，还管理如全局变量和常量等在程序中需要存取的数据。

### 4. **Relocation Information（重定位信息）**

重定位信息标识出程序中需要在链接时进行修改的部分。由于程序在编译阶段可能无法知道符号（如函数和变量）的最终地址，重定位信息帮助链接器在链接阶段调整程序中的地址引用。

- **作用**：在程序中，一些符号地址（例如函数调用或全局变量）是无法在编译阶段确定的，这些符号的引用需要在链接时根据符号表的信息进行修正。
- **内容**：每个重定位条目会指定需要修正的代码段或数据段中的地址和类型。链接器会根据这些信息，调整程序中的符号引用，确保它们指向正确的内存地址。

在 RISC-V 中，重定位信息通常存储在 **`.rel.text`**（代码段的重定位信息）和 **`.rel.data`**（数据段的重定位信息）中。

### 5. **Symbol Table（符号表）**

符号表包含了程序中所有符号（如变量、函数、标签等）的信息，并且提供符号与内存地址之间的映射。

- **内容**：符号表记录符号的名称、类型、大小、作用域和内存地址等。例如，`main` 函数的符号条目包含该函数的地址和类型。
- **用途**：符号表用于链接过程中将外部引用的符号解析为实际的内存地址，也用于程序的调试过程。

在 RISC-V 程序中，符号表通常以 `.symtab` 的形式出现，它为链接器提供了程序中所有符号的详细信息。

### 6. **Debugging Information（调试信息）**

调试信息为程序提供了源代码级别的调试支持，帮助开发人员在程序调试时跟踪源代码与机器代码之间的映射关系。

- **内容**：调试信息包含了源代码的行号、函数名称、变量名称、参数信息、程序栈信息等。这些信息允许开发者在调试时通过调试器（如 GDB）直接查看源代码并设置断点、单步调试等。
- **格式**：RISC-V 程序的调试信息通常采用 **DWARF** 格式存储，并包含在目标文件的 `.debug` 段中。

### 7. **ELF 格式（Executable and Linkable Format）**

ELF（可执行和可链接格式）是一个标准的文件格式，用于存储可执行文件、目标文件和共享库，广泛用于类 Unix 系统（包括 Linux）。在 RISC-V 程序中，ELF 格式通常用于存储目标文件和可执行文件。

- **文件结构**：ELF 文件格式包括以下几个部分：
    - **文件头（File Header）**：描述 ELF 文件的类型和架构等元信息。
    - **程序头（Program Header Table）**：描述程序如何加载到内存中。
    - **节头（Section Header Table）**：描述各个节（例如 `.text`、`.data`、`.bss`、`.symtab` 等）的布局。
    - **节（Sections）**：文件中的实际内容部分，例如：
        - **`.text`**：代码段。
        - **`.data`**：已初始化的数据段。
        - **`.bss`**：未初始化的数据段。
        - **`.symtab`**：符号表。
        - **`.rel.text`** 和 **`.rel.data`**：重定位信息。
        - **`.debug`**：调试信息。

### RISC-V 中 ELF 文件的组成

基于 RISC-V 架构的程序通常采用 ELF 格式，这个格式包括多个段和表格，主要包括：

1. **文件头**：标识文件格式和架构信息。
2. **文本段（`.text`）**：存储程序指令。
3. **数据段（`.data`）**：存储已初始化的数据。
4. **BSS段（`.bss`）**：存储未初始化的全局和静态数据。
5. **重定位信息（`.rel.text`、`.rel.data`）**：存储需要在链接时修改的符号和地址。
6. **符号表（`.symtab`）**：存储符号的信息。
7. **调试信息（`.debug`）**：帮助调试器将机器代码与源代码关联起来。